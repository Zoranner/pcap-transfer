# CSV 数据包结构设计

## 表格结构

### 表格结构说明

- **第 1 行**：列名（可选，用于文档说明）
- **第 2 行**：数据类型定义，指定每个数据的类型
- **第 3 行及以后**：实际数据，每行对应一个 UDP 数据包

### 表格格式

| 数据 1 | 数据 2 | 数据 3 | ... | 数据 N |
| ------ | ------ | ------ | --- | ------ |
| f32    | i32    | f64    | ... | bool   |
| 值 1   | 值 2   | 值 3   | ... | 值 N   |
| 值 1   | 值 2   | 值 3   | ... | 值 N   |
| ...    | ...    | ...    | ... | ...    |

### 数据值规则

- **动态值字段**：当数据类型不包含 `=` 时（如 `f32`、`i32`），数据值单元格填写实际数值，如为空则使用该类型的默认值
- **固定值字段**：当数据类型包含 `=值` 时（如 `hex=0x01`），该值作为默认值，如果数据值单元格有值则优先使用单元格的值
- **随机值字段**：当数据类型包含 `=rand(最小值,最大值)` 时（如 `"u32=rand(20,30)"`），该函数作为默认值生成器，如果数据值单元格有值则优先使用单元格的值
- **循环值字段**：当数据类型包含 `=loop(值1,值2,值3,...)` 时（如 `"i32=loop(11,22)"`），该函数作为默认值生成器，如果数据值单元格有值则优先使用单元格的值

> **注意**：包含逗号的表达式（如 `rand(20,30)`、`loop(11,22,33)`）必须用双引号包围，避免被 CSV 解析器误分割。

## 数据类型

### 支持的数据类型

| 数据类型        | 类型 | 字节数 | 默认值 |
| --------------- | ---- | ------ | ------ |
| 8 位整数        | i8   | 1      | 0      |
| 16 位整数       | i16  | 2      | 0      |
| 32 位整数       | i32  | 4      | 0      |
| 64 位整数       | i64  | 8      | 0      |
| 8 位无符号整数  | u8   | 1      | 0      |
| 16 位无符号整数 | u16  | 2      | 0      |
| 32 位无符号整数 | u32  | 4      | 0      |
| 64 位无符号整数 | u64  | 8      | 0      |
| 32 位浮点       | f32  | 4      | 0.0    |
| 64 位浮点       | f64  | 8      | 0.0    |
| 布尔值          | bool | 1      | false  |
| 十六进制值      | hex  | 1-N    | 0x00   |

### 十六进制值类型

- **语法**：`hex=值` 或 `hex_N=值`（值为十六进制）
- **说明**：指定十六进制值，位数可从值自动推断或手动指定
- **示例**：
  - `hex=0xFF` → 1个字节的 `0xFF`
  - `hex=0x1234` → 2个字节的 `0x1234`
  - `hex_4=0x12345678` → 4个字节的 `0x12345678`

## 函数计算

### 随机值函数

- **语法**：`类型=rand(最小值,最大值)` 或 `类型=rand()`（仅布尔类型）
- **说明**：在指定范围内随机生成数值，每次生成数据包时都会产生不同的随机值
- **支持的类型**：
  - **整数类型**：`"i8=rand(-128,127)"`、`"u32=rand(20,30)"` 等
  - **浮点类型**：`"f32=rand(20.5,30.8)"`、`"f64=rand(100.0,200.0)"` 等
  - **布尔类型**：`"bool=rand()"` → 随机生成 `true` 或 `false`
  - **十六进制类型**：`"hex=rand(0x00,0xFF)"` → 随机生成指定范围的十六进制值
- **注意事项**：
  - 最小值不能大于最大值
  - 范围值必须在数据类型的有效范围内
  - 浮点数的精度取决于具体实现
  - 布尔类型不需要指定范围，直接使用 `"bool=rand()"`

### 循环值函数

- **语法**：`类型=loop(值1,值2,值3,...)`
- **说明**：在指定的值列表中按顺序循环使用，每次生成数据包时使用下一个值，用完后重新从第一个值开始
- **支持的类型**：
  - **整数类型**：`"i32=loop(11,22,33)"` → 依次使用 11, 22, 33, 11, 22, 33...
  - **浮点类型**：`"f32=loop(1.5,2.5,3.5)"` → 依次使用 1.5, 2.5, 3.5, 1.5, 2.5, 3.5...
  - **布尔类型**：`"bool=loop(true,false)"` → 依次使用 true, false, true, false...
  - **十六进制类型**：`"hex=loop(0x01,0x02,0x03)"` → 依次使用 0x01, 0x02, 0x03, 0x01, 0x02, 0x03...
- **注意事项**：
  - 至少需要提供两个值
  - 所有值必须在数据类型的有效范围内
  - 循环顺序固定，不会随机打乱
  - 适用于需要按固定模式变化的数据

## 数据包示例

假设定义了一个包含基本类型、固定值、随机值和循环值的表格：

| 版本     | 温度 | 湿度 | 压力 | 目标ID    | 状态标志 | 随机计数器 | 循环ID |
| -------- | ---- | ---- | ---- | --------- | -------- | ---------- | ------ |
| hex=0x01 | f32  | f32  | i32  | i8=8001   | hex=0x01 | "u32=rand(20,30)" | "i32=loop(11,22)" |
|          | 25.5 | 60.2 | 1013 |           |          |            |        |
|          | 26.1 | 58.9 |      |           |          |            |        |
|          | 27.0 | 55.5 | 1020 |           |          | 25         | 33     |

### 第 1 个数据包

```
版本:    0x01 (hex=0x01)
温度:    0x41CC0000 (25.5f32)
湿度:    0x4270CCCD (60.2f32)
压力:    0x000003F5 (1013i32)
目标ID:  0x1F (i8=8001)
状态标志: 0x01 (hex=0x01)
随机计数器: 0x0000001A (26u32，随机生成20-30之间的值)
循环ID:  0x0000000B (11i32，循环值第一个)
```

### 第 2 个数据包

```
版本:    0x01 (hex=0x01)
温度:    0x41D1999A (26.1f32)
湿度:    0x426B3333 (58.9f32)
压力:    0x00000000 (0i32，使用默认值)
目标ID:  0x1F (i8=8001)
状态标志: 0x01 (hex=0x01)
随机计数器: 0x0000001D (29u32，随机生成20-30之间的值)
循环ID:  0x00000016 (22i32，循环值第二个)
```

### 第 3 个数据包

```
版本:    0x01 (hex=0x01)
温度:    0x41D80000 (27.0f32)
湿度:    0x425E6666 (55.5f32)
压力:    0x000003FC (1020i32)
目标ID:  0x1F (i8=8001)
状态标志: 0x01 (hex=0x01)
随机计数器: 0x00000019 (25u32，使用单元格中的值覆盖随机值)
循环ID:  0x00000021 (33i32，使用单元格中的值覆盖循环值)
```

**单个数据包大小：20 字节**